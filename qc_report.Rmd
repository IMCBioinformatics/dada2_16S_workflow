---
title: "Run Quality Report"
author:
    - "IMC Bioinformatics"
date: "`r format(Sys.time(), '%d %B, %Y')`"
params:
   rmd: "qc_report.Rmd"
output:
  html_document:
  highlight: tango
  number_sections: no
  theme: default
  toc: yes
  toc_depth: 3
  toc_float:
    collapsed: no
    smooth_scroll: yes
---


Sys.setenv(RSTUDIO_PANDOC="~/softwares/miniconda/envs/snakemake/bin/pandoc")

## Overall read quality plots {.tabset .tabset-fade}

<br>

### Read quality raw 

<br>

```{r,results='asis', echo=F}
path=snakemake@config[["path"]]


files <- list.files(path = paste(path,"output/figures/quality/",sep=""), pattern = "raw", full.names = 
TRUE)

for (f in files) {
   cat(paste0("![image_label](", f, "){width=50%}"))
}

```


### Read Quality after read trimming

<br>

```{r, results='asis',echo=F}

files <- list.files(path = paste(path,"output/figures/quality/",sep=""), pattern = "predada2", full.names =
TRUE)
for (f in files) {
   cat(paste0("![image_label](", f, "){width=50%}"))
  }
```


### Read Quality after read filtering

<br>

```{r, results='asis', echo=F}

files <- list.files(path = paste(path,"output/figures/quality/",sep=""), pattern = "postdada2", full.names =
TRUE)
for (f in files) {
   cat(paste0("![image_label](", f, "){width=50%}"))
  }
```


## Read length distribution for 5 random samples in the run {.tabset .tabset-fade}

<br>

### Sample 1

```{r, results='asis', echo=F}

files <- list.files(path = paste(path,"output/figures/ReadsLength/",sep=""), pattern = "S1", full.names =TRUE)

for (f in files) {
  cat(paste0("![image_label](", f, ")\n"))
  }
```



### Sample 2

```{r, results='asis', echo=F}

files <- list.files(path = paste(path,"output/figures/ReadsLength/",sep=""), pattern = "S2", full.names =TRUE)

for (f in files) {
  cat(paste0("![image_label](", f, ")\n"))
  }
```



### Sample 3

```{r, results='asis', echo=F}

files <- list.files(path = paste(path,"output/figures/ReadsLength/",sep=""), pattern = "S3", full.names =TRUE)

for (f in files) {
  cat(paste0("![image_label](", f, ")\n"))
  }
```



### Sample 4

```{r, results='asis', echo=F}

files <- list.files(path = paste(path,"output/figures/ReadsLength/",sep=""), pattern = "S4", full.names =TRUE)

for (f in files) {
  cat(paste0("![image_label](", f, ")\n"))
  }
```



### Sample 5

```{r, results='asis', echo=F}

files <- list.files(path = paste(path,"output/figures/ReadsLength/",sep=""), pattern = "S5", full.names =TRUE)

for (f in files) {
  cat(paste0("![image_label](", f, ")\n"))
  }
```



<br>


## Table of Reads at each step per sample

<br>

```{r,echo=F,messages=FALSE, warnings=FALSE}

suppressMessages(library(knitr))
suppressMessages(library(DT))
suppressMessages(library(tidyr))
suppressMessages(library(dplyr))


reads<-read.csv(paste(path,"output/dada2/Nreads.tsv",sep=""),sep="\t")

datatable(reads,caption="Read processing")

```



## Source
<a download="qc_report.Rmd" href="`r base64enc::dataURI(file = params$rmd, mime = 'text/rmd', encoding = 'base64')`">R Markdown source file (to produce this document)</a>
